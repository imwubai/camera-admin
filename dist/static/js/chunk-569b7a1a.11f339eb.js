(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-569b7a1a"],{1148:function(t,e,i){"use strict";var r=i("a691"),s=i("1d80");t.exports="".repeat||function(t){var e=String(s(this)),i="",o=r(t);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(i+=e);return i}},"408a":function(t,e,i){var r=i("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=r(t))throw TypeError("Incorrect invocation");return+t}},"7a8b":function(t,e,i){},"88e0":function(t,e,i){},"92e3":function(t,e,i){"use strict";var r=i("88e0"),s=i.n(r);s.a},"99d6":function(t,e,i){"use strict";var r=i("7a8b"),s=i.n(r);s.a},"9b56":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"160px",rules:t.formRules}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"路口方位",prop:"location"}},[i("el-input",{attrs:{maxlength:"50",clearable:""},model:{value:t.form.location,callback:function(e){t.$set(t.form,"location",e)},expression:"form.location"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"摄像机1 RTSP名称",prop:"big_cam_name"}},[i("el-input",{attrs:{maxlength:"50",clearable:""},model:{value:t.form.big_cam_name,callback:function(e){t.$set(t.form,"big_cam_name",e)},expression:"form.big_cam_name"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-button",{staticClass:"test_btn",attrs:{type:"primary",plain:"",loading:t.test_cam_loading},on:{click:function(e){return t.showDialog(t.form.big_cam_name)}}},[t._v("测试摄像机1")]),i("el-button",{staticClass:"test_btn",attrs:{type:"primary",plain:"",loading:t.test_cam_loading},on:{click:function(e){return t.showSetRedLightModal(t.form.big_cam_name)}}},[t._v("画线设置")])],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"摄像机3 RTSP名称",prop:"small_cam_name"}},[i("el-input",{attrs:{maxlength:"50",clearable:""},model:{value:t.form.small_cam_name,callback:function(e){t.$set(t.form,"small_cam_name",e)},expression:"form.small_cam_name"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-button",{staticClass:"test_btn",attrs:{type:"primary",plain:"",loading:t.test_cam_loading},on:{click:function(e){return t.showDialog(t.form.small_cam_name)}}},[t._v("测试摄像机3")])],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"图片上下比例",prop:"propotion"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:100,step:1},model:{value:t.form.propotion,callback:function(e){t.$set(t.form,"propotion",e)},expression:"form.propotion"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"抓拍间隔",prop:"detect_interval"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:25,step:1},model:{value:t.form.detect_interval,callback:function(e){t.$set(t.form,"detect_interval",e)},expression:"form.detect_interval"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"摩托识别置信度",prop:"moto_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.moto_thres,callback:function(e){t.$set(t.form,"moto_thres",e)},expression:"form.moto_thres"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"自行车识别置信度",prop:"bike_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.bike_thres,callback:function(e){t.$set(t.form,"bike_thres",e)},expression:"form.bike_thres"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"人脸识别置信度",prop:"person_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.person_thres,callback:function(e){t.$set(t.form,"person_thres",e)},expression:"form.person_thres"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"脸部识别置信度",prop:"face_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.face_thres,callback:function(e){t.$set(t.form,"face_thres",e)},expression:"form.face_thres"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"头盔识别置信度",prop:"helmet_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.helmet_thres,callback:function(e){t.$set(t.form,"helmet_thres",e)},expression:"form.helmet_thres"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"伞具识别置信度",prop:"umbrella_thres"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,max:1500,step:.1},model:{value:t.form.umbrella_thres,callback:function(e){t.$set(t.form,"umbrella_thres",e)},expression:"form.umbrella_thres"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"交通灯颜色",prop:"signal_color_value"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.signal_color_value,callback:function(e){t.$set(t.form,"signal_color_value",e)},expression:"form.signal_color_value"}},t._l(t.signal_color,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"摄像机方位",prop:"direction_value"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.direction_value,callback:function(e){t.$set(t.form,"direction_value",e)},expression:"form.direction_value"}},t._l(t.direction,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:t.saveLoading},on:{click:t.onSubmit}},[t._v("保存")])],1)],1),i("el-dialog",{attrs:{title:"测试照片",visible:t.dialogVisible,width:"1000px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{staticClass:"dialogimg",attrs:{src:t.imgSrc}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)]),i("el-dialog",{staticClass:"red-light-dialog",attrs:{title:"设置红灯",visible:t.redLightVisible,"close-on-click-modal":!1,width:"1020px"},on:{"update:visible":function(e){t.redLightVisible=e}}},[i("SetRedLight",{ref:"setRedLightRef",attrs:{"img-url":t.imgUrl}}),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.redLightVisible=!1}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.saveSetRedLight}},[t._v("保存")])],1)],1)],1)},s=[],o=(i("99af"),i("a9e3"),i("b680"),i("b64b"),i("5530")),a=i("b775"),n=i("01ea"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"set-red-light"},[i("div",{staticClass:"switch-buttons"},[i("el-button",{attrs:{size:"small",type:t.openDrawRed?"primary":""},on:{click:t.switchopenDrawRed}},[t._v("画红灯位置")]),i("el-button",{attrs:{size:"small",type:t.openDrawLeft?"primary":""},on:{click:t.switchopenDrawLeft}},[t._v("画左边线")]),i("el-button",{attrs:{size:"small",type:t.openDrawRight?"primary":""},on:{click:t.switchopenDrawRight}},[t._v("画右边线")]),i("el-button",{attrs:{size:"small",type:t.openDrawStop?"primary":""},on:{click:t.switchopenDrawStop}},[t._v("画停车线")]),i("el-button",{attrs:{size:"small",type:t.openDrawRedStop?"primary":""},on:{click:t.switchopenDrawRedStop}},[t._v("画红灯线")]),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:t.reset}},[t._v("重置")])],1),i("div",{staticClass:"box",style:{width:t.imgInitialWidth+"px",height:t.imgInitialHeight+"px"}},[i("canvas",{attrs:{id:"bg-img",width:t.width,height:t.height}}),i("canvas",{attrs:{id:"left-img",width:t.width,height:t.height}}),i("canvas",{attrs:{id:"right-img",width:t.width,height:t.height}}),i("canvas",{attrs:{id:"stop-img",width:t.width,height:t.height}}),i("canvas",{attrs:{id:"redStop-img",width:t.width,height:t.height}}),i("canvas",{style:{cursor:t.cursorStyleVal},attrs:{id:"red-img",width:t.width,height:t.height},on:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMousedown(e)},mouseup:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMouseup(e)},mousemove:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMousemove(e)},mouseleave:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMouseleave(e)},click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSwitchScale(e)}}})])])},h=[],d=(i("caad"),i("d3b7"),i("ac1f"),i("25f0"),i("2532"),i("1276"),{name:"SetRedLight",props:{imgUrl:{type:String,default:""}},data:function(){return{bgCtx:null,leftCtx:null,rightCtx:null,stopCtx:null,redStopCtx:null,redCtx:null,width:0,height:0,imgInitialWidth:1e3,imgInitialHeight:0,imgOriginWidth:0,imgOriginHeight:0,top:0,left:0,zoomVal:1,enableMouseDown:!1,leftStartX:0,rightStartX:0,stopStartX:0,redStopStartX:0,redStartX:0,leftStartY:0,rightStartY:0,stopStartY:0,redStopStartY:0,redStartY:0,leftEndX:0,rightEndX:0,stopEndX:0,redStopEndX:0,redEndX:0,leftEndY:0,rightEndY:0,stopEndY:0,redStopEndY:0,redEndY:0,isDrawLeftInTransform:!1,isDrawRightInTransform:!1,isDrawStopInTransform:!1,isDrawRedStopInTransform:!1,isDrawRedInTransform:!1,isOriginImg:!1,openDrawLeft:!1,openDrawRight:!1,openDrawStop:!1,openDrawRedStop:!1,openDrawRed:!1,leftLintPoint:{},rightLintPoint:{},stopLintPoint:{},redStopLintPoint:{},redPoint:{}}},computed:{cursorStyleVal:function(){return this.openDrawLeft||this.openDrawRight||this.openDrawStop||this.openDrawRedStop||this.openDrawRed?"crosshair":this.isOriginImg?"zoom-out":"zoom-in"},result:function(){var t={},e={},i={},r={},s={};if(Object.keys(this.leftLintPoint).length>0){var o=this.leftLintPoint,a=o.start,n=o.end,l=a.split(","),h=n.split(",");t=(this.isOriginImg,{start:[this.realX(l[0]),this.realY(l[1])],end:[this.realX(h[0]),this.realY(h[1])]})}if(Object.keys(this.rightLintPoint).length>0){var d=this.rightLintPoint,c=d.start,p=d.end,f=c.split(","),g=p.split(",");e=this.isOriginImg?{start:f,end:g}:{start:[this.realX(f[0]),this.realY(f[1])],end:[this.realX(g[0]),this.realY(g[1])]}}if(Object.keys(this.stopLintPoint).length>0){var m=this.stopLintPoint,u=m.start,w=m.end,b=u.split(","),S=w.split(",");i=this.isOriginImg?{start:b,end:S}:{start:[this.realX(b[0]),this.realY(b[1])],end:[this.realX(S[0]),this.realY(S[1])]}}if(Object.keys(this.redStopLintPoint).length>0){var v=this.redStopLintPoint,_=v.start,X=v.end,Y=_.split(","),D=X.split(",");r=this.isOriginImg?{start:Y,end:D}:{start:[this.realX(Y[0]),this.realY(Y[1])],end:[this.realX(D[0]),this.realY(D[1])]}}if(Object.keys(this.redPoint).length>0){var x=this.redPoint,R=x.leftTop,E=x.rightBottom,L=R.split(","),I=E.split(",");s=this.isOriginImg?{leftTop:L,rightBottom:I}:{leftTop:[this.realX(L[0]),this.realY(L[1])],rightBottom:[this.realX(I[0]),this.realY(I[1])]}}return{left:t,right:e,stop:i,redStop:r,red:s}}},mounted:function(){this.initDraw(!0)},methods:{scaleX:function(t){var e=this.imgInitialWidth/this.imgOriginWidth,i=e.toString(),r=1;return i.includes(".")&&(r=i.split(".")[1].length+1),t*Math.pow(10,r)*(e*Math.pow(10,r))/(Math.pow(10,r)*Math.pow(10,r))},realX:function(t){var e=this.imgOriginWidth/this.imgInitialWidth,i=e.toString(),r=1;return i.includes(".")&&(r=i.split(".")[1].length+1),e*Math.pow(10,r)*t/Math.pow(10,r)},scaleY:function(t){var e=this.imgInitialHeight/this.imgOriginHeight,i=e.toString(),r=1;return i.includes(".")&&(r=i.split(".")[1].length+1),t*Math.pow(10,r)*(e*Math.pow(10,r))/(Math.pow(10,r)*Math.pow(10,r))},realY:function(t){var e=this.imgOriginHeight/this.imgInitialHeight,i=e.toString(),r=1;return i.includes(".")&&(r=i.split(".")[1].length+1),e*Math.pow(10,r)*t/Math.pow(10,r)},initDraw:function(t){var e=this;t&&(this.bgCtx=document.getElementById("bg-img").getContext("2d"),this.leftCtx=document.getElementById("left-img").getContext("2d"),this.rightCtx=document.getElementById("right-img").getContext("2d"),this.stopCtx=document.getElementById("stop-img").getContext("2d"),this.redStopCtx=document.getElementById("redStop-img").getContext("2d"),this.redCtx=document.getElementById("red-img").getContext("2d"));var i=new Image;i.src=this.imgUrl,i.crossOrigin="Anonymous",i.onload=function(){if(e.isOriginImg)e.width=i.width,e.height=i.height;else{var r=e.imgInitialWidth/i.width*i.height;e.width=e.imgInitialWidth,e.height=r,t&&(e.imgInitialHeight=r)}e.imgOriginWidth=i.width,e.imgOriginHeight=i.height,setTimeout((function(){if(e.bgCtx.drawImage(i,0,0,e.width,e.height),Object.keys(e.leftLintPoint).length>0){var t=e.leftLintPoint,r=t.start,s=t.end,o=r.split(","),a=s.split(",");e.drawLine(e.leftCtx,o[0],o[1],a[0],a[1],"Left")}if(Object.keys(e.rightLintPoint).length>0){var n=e.rightLintPoint,l=n.start,h=n.end,d=l.split(","),c=h.split(",");e.drawLine(e.rightCtx,d[0],d[1],c[0],c[1],"Right")}if(Object.keys(e.stopLintPoint).length>0){var p=e.stopLintPoint,f=p.start,g=p.end,m=f.split(","),u=g.split(",");e.drawLine(e.stopCtx,m[0],m[1],u[0],u[1],"Stop")}if(Object.keys(e.redStopLintPoint).length>0){var w=e.redStopLintPoint,b=w.start,S=w.end,v=b.split(","),_=S.split(",");e.drawLine(e.redStopCtx,v[0],v[1],_[0],_[1],"RedStop")}if(Object.keys(e.redPoint).length>0){var X=e.redPoint,Y=X.leftTop,D=X.rightTop,x=X.leftBottom,R=Y.split(","),E=D.split(","),L=x.split(","),I=E[0]-R[0],y=L[1]-R[1];e.redCtx.clearRect(0,0,e.width,e.height),e.redCtx.strokeStyle="#f00",e.redCtx.lineWidth=2,e.redCtx.beginPath(),e.isOriginImg&&!e.isDrawRedInTransform?(e.redCtx.moveTo(e.realX(R[0]),e.realY(R[1])),e.redCtx.rect(e.realX(R[0]),e.realY(R[1]),e.realX(I),e.realY(y))):!e.isOriginImg&&e.isDrawRedInTransform?(e.redCtx.moveTo(e.scaleX(R[0]),e.scaleY(R[1])),e.redCtx.rect(e.scaleX(R[0]),e.scaleY(R[1]),e.scaleX(I),e.scaleY(y))):(e.redCtx.moveTo(R[0],R[1]),e.redCtx.rect(R[0],R[1],I,y)),e.redCtx.closePath(),e.redCtx.stroke()}}),0)}},drawLine:function(t,e,i,r,s,o){t.clearRect(0,0,this.width,this.height),t.strokeStyle="#f00",t.lineWidth=2,t.beginPath(),this.isOriginImg&&!this["isDraw".concat(o,"InTransform")]?(t.moveTo(this.realX(e),this.realY(i)),t.lineTo(this.realX(r),this.realY(s))):!this.isOriginImg&&this["isDraw".concat(o,"InTransform")]?(t.moveTo(this.scaleX(e),this.scaleY(i)),t.lineTo(this.scaleX(r),this.scaleY(s))):(t.moveTo(e,i),t.lineTo(r,s)),t.closePath(),t.stroke()},handleSwitchScale:function(){this.openDrawLeft||this.openDrawRight||this.openDrawStop||this.openDrawRedStop||this.openDrawRed||(this.isOriginImg=!this.isOriginImg,this.initDraw())},switchopenDrawLeft:function(){this.openDrawLeft=!this.openDrawLeft,this.openDrawRight=!1,this.openDrawStop=!1,this.openDrawRedStop=!1,this.openDrawRed=!1},switchopenDrawRight:function(){this.openDrawRight=!this.openDrawRight,this.openDrawLeft=!1,this.openDrawStop=!1,this.openDrawRedStop=!1,this.openDrawRed=!1},switchopenDrawStop:function(){this.openDrawStop=!this.openDrawStop,this.openDrawRight=!1,this.openDrawLeft=!1,this.openDrawRedStop=!1,this.openDrawRed=!1},switchopenDrawRedStop:function(){this.openDrawRedStop=!this.openDrawRedStop,this.openDrawRight=!1,this.openDrawLeft=!1,this.openDrawStop=!1,this.openDrawRed=!1},switchopenDrawRed:function(){this.openDrawRed=!this.openDrawRed,this.openDrawRight=!1,this.openDrawStop=!1,this.openDrawRedStop=!1,this.openDrawLeft=!1},save:function(){(this.leftStartX||this.leftStartY||this.leftEndX||this.leftEndY)&&(this.leftLintPoint={start:"".concat(this.leftStartX,",").concat(this.leftStartY),end:"".concat(this.leftEndX,",").concat(this.leftEndY)}),(this.rightStartX||this.rightStartY||this.rightEndX||this.rightEndY)&&(this.rightLintPoint={start:"".concat(this.rightStartX,",").concat(this.rightStartY),end:"".concat(this.rightEndX,",").concat(this.rightEndY)}),(this.stopStartX||this.stopStartY||this.stopEndX||this.stopEndY)&&(this.stopLintPoint={start:"".concat(this.stopStartX,",").concat(this.stopStartY),end:"".concat(this.stopEndX,",").concat(this.stopEndY)}),(this.redStopStartX||this.redStopStartY||this.redStopEndX||this.redStopEndY)&&(this.redStopLintPoint={start:"".concat(this.redStopStartX,",").concat(this.redStopStartY),end:"".concat(this.redStopEndX,",").concat(this.redStopEndY)}),(this.redStartX||this.redStartY||this.redEndX||this.redEndY)&&(this.redEndX>this.redStartX&&this.redEndY>this.redStartY?this.redPoint={leftTop:"".concat(this.redStartX,",").concat(this.redStartY),rightTop:"".concat(this.redEndX,",").concat(this.redStartY),leftBottom:"".concat(this.redStartX,",").concat(this.redEndY),rightBottom:"".concat(this.redEndX,",").concat(this.redEndY)}:this.redEndX>this.redStartX&&this.redEndY<this.redStartY?this.redPoint={leftTop:"".concat(this.redStartX,",").concat(this.redEndY),rightTop:"".concat(this.redEndX,",").concat(this.redEndY),leftBottom:"".concat(this.redStartX,",").concat(this.redStartY),rightBottom:"".concat(this.redEndX,",").concat(this.redStartY)}:this.redEndX<this.redStartX&&this.redEndY<this.redStartY?this.redPoint={leftTop:"".concat(this.redEndX,",").concat(this.redEndY),rightTop:"".concat(this.redStartX,",").concat(this.redEndY),leftBottom:"".concat(this.redEndX,",").concat(this.redStartY),rightBottom:"".concat(this.redStartX,",").concat(this.redEndY)}:this.redPoint={leftTop:"".concat(this.redEndX,",").concat(this.redStartY),rightTop:"".concat(this.redStartX,",").concat(this.redStartY),leftBottom:"".concat(this.redEndX,",").concat(this.redEndY),rightBottom:"".concat(this.redStartX,",").concat(this.redEndY)})},reset:function(){this.leftCtx.clearRect(0,0,this.width,this.height),this.rightCtx.clearRect(0,0,this.width,this.height),this.stopCtx.clearRect(0,0,this.width,this.height),this.redStopCtx.clearRect(0,0,this.width,this.height),this.redCtx.clearRect(0,0,this.width,this.height),Object.assign(this.$data,this.$options.data()),this.initDraw(!0)},handleMousedown:function(t){this.enableMouseDown=!0,this.openDrawLeft?(this.leftStartX=t.offsetX,this.leftStartY=t.offsetY):this.openDrawRight?(this.rightStartX=t.offsetX,this.rightStartY=t.offsetY):this.openDrawStop?(this.stopStartX=t.offsetX,this.stopStartY=t.offsetY):this.openDrawRedStop?(this.redStopStartX=t.offsetX,this.redStopStartY=t.offsetY):this.openDrawRed?(this.redStartX=t.offsetX,this.redStartY=t.offsetY):(this.wheelStartX=t.offsetX,this.wheelStartY=t.offsetY)},handleMouseup:function(t){this.enableMouseDown=!1,this.openDrawLeft?(this.leftEndX=t.offsetX,this.leftEndY=t.offsetY):this.openDrawRight?(this.rightEndX=t.offsetX,this.rightEndY=t.offsetY):this.openDrawStop?(this.stopEndX=t.offsetX,this.stopEndY=t.offsetY):this.openDrawRedStop?(this.redStopEndX=t.offsetX,this.redStopEndY=t.offsetY):this.openDrawRed?(this.redEndX=t.offsetX,this.redEndY=t.offsetY):(this.wheelEndX=t.offsetX,this.wheelEndY=t.offsetY),this.save()},handleMouseleave:function(){this.enableMouseDown=!1},handleMousemove:function(t){if(this.enableMouseDown)if(this.openDrawLeft||this.openDrawRight||this.openDrawStop||this.openDrawRedStop)this.openDrawLeft?(this.isDrawLeftInTransform=this.isOriginImg,this.drawLine(this.leftCtx,this.leftStartX,this.leftStartY,t.offsetX,t.offsetY,"Left")):this.openDrawRight?(this.isDrawRightInTransform=this.isOriginImg,this.drawLine(this.rightCtx,this.rightStartX,this.rightStartY,t.offsetX,t.offsetY,"Right")):this.openDrawStop?(this.isDrawStopInTransform=this.isOriginImg,this.drawLine(this.stopCtx,this.stopStartX,this.stopStartY,t.offsetX,t.offsetY,"Stop")):this.openDrawRedStop&&(this.isDrawRedStopInTransform=this.isOriginImg,this.drawLine(this.redStopCtx,this.redStopStartX,this.redStopStartY,t.offsetX,t.offsetY,"RedStop"));else if(this.openDrawRed){this.isDrawRedInTransform=this.isOriginImg,this.redCtx.clearRect(0,0,this.width,this.height),this.redCtx.strokeStyle="#f00",this.redCtx.lineWidth=2,this.redCtx.beginPath(),this.redCtx.moveTo(this.redStartX,this.redStartY);var e=Math.abs(t.offsetX-this.redStartX),i=Math.abs(t.offsetY-this.redStartY);t.offsetX>this.redStartX&&t.offsetY>this.redStartY?this.redCtx.rect(this.redStartX,this.redStartY,e,i):t.offsetX>this.redStartX&&t.offsetY<this.redStartY?this.redCtx.rect(this.redStartX,t.offsetY,e,i):t.offsetX<this.redStartX&&t.offsetY<this.redStartY?this.redCtx.rect(t.offsetX,t.offsetY,e,i):this.redCtx.rect(t.offsetX,this.redStartY,e,i),this.redCtx.closePath(),this.redCtx.stroke()}}}}),c=d,p=(i("99d6"),i("2877")),f=Object(p["a"])(c,l,h,!1,null,null,null),g=f.exports,m={components:{SetRedLight:g},data:function(){var t=function(t,e,i){0==e||e?i():i(new Error("请输入必填项"))};return{formRules:{big_cam_name:[{required:!0,trigger:"blur",validator:t}],bike_thres:[{required:!0,trigger:"blur",validator:t}],detect_interval:[{required:!0,trigger:"blur",validator:t}],face_thres:[{required:!0,trigger:"blur",validator:t}],helmet_thres:[{required:!0,trigger:"blur",validator:t}],location:[{required:!0,trigger:"blur",validator:t}],moto_thres:[{required:!0,trigger:"blur",validator:t}],person_thres:[{required:!0,trigger:"blur",validator:t}],propotion:[{required:!0,trigger:"blur",validator:t}],small_cam_name:[{required:!0,trigger:"blur",validator:t}],umbrella_thres:[{required:!0,trigger:"blur",validator:t}],signal_color_value:[{required:!0,trigger:"blur",validator:t}],direction_value:[{required:!0,trigger:"blur",validator:t}]},saveLoading:!1,dialogVisible:!1,imgSrc:"",test_cam_loading:!1,signal_color:[{value:"0",label:"红灯"},{value:"1",label:"黄灯"},{value:"2",label:"绿灯"}],direction:[{value:"0",label:"对脸"},{value:"1",label:"对背"}],imgUrl:"",redLightVisible:!1,redLightResult:{},form:{big_cam_name:"",bike_thres:"",detect_interval:2,face_thres:"",helmet_thres:"",location:"",moto_thres:"",person_thres:"",propotion:50,small_cam_name:"",umbrella_thres:"",signal_color_value:"0",direction_value:"0"}}},mounted:function(){this.getDefaultData()},methods:{showSetRedLightModal:function(t){var e=this;this.test_cam_loading=!0,a["a"].post("/test_pic",{cam_name:t}).then((function(t){e.test_cam_loading=!1;var i="".concat(n["a"],"/").concat(t.data.filepath);e.imgUrl=i,e.redLightVisible=!0})).catch((function(t){e.test_cam_loading=!1,e.$message({message:"获取照片失败",type:"error"})}))},saveSetRedLight:function(){var t=this.$refs.setRedLightRef,e=t.result,i=e.left,r=e.right,s=e.stop,o=e.redStop,a=e.red;0!==Object.keys(i).length?0!==Object.keys(r).length?0!==Object.keys(s).length?0!==Object.keys(o).length?0!==Object.keys(a).length?(this.redLightVisible=!1,this.redLightResult=t.result):this.$message({type:"warning",message:"未画红灯位置"}):this.$message({type:"warning",message:"未画红灯线"}):this.$message({type:"warning",message:"未画停车线"}):this.$message({type:"warning",message:"未画右边线"}):this.$message({type:"warning",message:"未画左边线"})},getDefaultData:function(){var t=this;a["a"].post("/get_big_cam").then((function(e){Object.assign(t.form,e.data)})).catch((function(e){t.$message({message:"获取摄像机设置服务异常",type:"error"})}))},showDialog:function(t){var e=this;this.test_cam_loading=!0,a["a"].post("/test_pic",{cam_name:t}).then((function(t){console.log(t),e.test_cam_loading=!1;var i="".concat(n["a"],"/").concat(t.data.filepath);Object.assign(e,{dialogVisible:!0,imgSrc:i})})).catch((function(t){e.test_cam_loading=!1,e.$message({message:"获取照片失败",type:"error"})}))},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.saveLoading=!0;var i=Object(o["a"])({direction:Number(t.form.direction_value),signal_color:Number(t.form.signal_color_value)},t.form);if(Object.keys(t.redLightResult).length>0){var r=t.redLightResult,s=r.left,n=r.right,l=r.stop,h=r.red,d=r.redStop,c=Number(((s.end[0]-s.start[0])/(s.end[1]-s.start[1])).toFixed(2)),p=Number(((n.end[0]-n.start[0])/(n.end[1]-n.start[1])).toFixed(2));Object.assign(i,{signal_left:Number(h.leftTop[0].toFixed(0)),signal_top:Number(h.leftTop[1].toFixed(0)),signal_right:Number(h.rightBottom[0].toFixed(0)),signal_bottom:Number(h.rightBottom[1].toFixed(0)),red_line:Number(d.start[1].toFixed(0)),overline:Number(l.start[1].toFixed(0)),left_x:Number((s.start[0]-c*s.start[1]).toFixed(0)),left_slope:c,right_x:Number((n.start[0]-p*n.start[1]).toFixed(0)),right_slope:p})}a["a"].post("/set_big_cam",i).then((function(e){t.saveLoading=!1,t.$message({message:"设置成功",type:"success"})})).catch((function(){t.saveLoading=!1,t.$message({message:"摄像机设置异常",type:"error"})}))}}))}}},u=m,w=(i("92e3"),Object(p["a"])(u,r,s,!1,null,null,null));e["default"]=w.exports},a9e3:function(t,e,i){"use strict";var r=i("83ab"),s=i("da84"),o=i("94ca"),a=i("6eeb"),n=i("5135"),l=i("c6b6"),h=i("7156"),d=i("c04e"),c=i("d039"),p=i("7c73"),f=i("241c").f,g=i("06cf").f,m=i("9bf2").f,u=i("58a8").trim,w="Number",b=s[w],S=b.prototype,v=l(p(S))==w,_=function(t){var e,i,r,s,o,a,n,l,h=d(t,!1);if("string"==typeof h&&h.length>2)if(h=u(h),e=h.charCodeAt(0),43===e||45===e){if(i=h.charCodeAt(2),88===i||120===i)return NaN}else if(48===e){switch(h.charCodeAt(1)){case 66:case 98:r=2,s=49;break;case 79:case 111:r=8,s=55;break;default:return+h}for(o=h.slice(2),a=o.length,n=0;n<a;n++)if(l=o.charCodeAt(n),l<48||l>s)return NaN;return parseInt(o,r)}return+h};if(o(w,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var X,Y=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof Y&&(v?c((function(){S.valueOf.call(i)})):l(i)!=w)?h(new b(_(e)),i,Y):_(e)},D=r?f(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;D.length>x;x++)n(b,X=D[x])&&!n(Y,X)&&m(Y,X,g(b,X));Y.prototype=S,S.constructor=Y,a(s,w,Y)}},b680:function(t,e,i){"use strict";var r=i("23e7"),s=i("a691"),o=i("408a"),a=i("1148"),n=i("d039"),l=1..toFixed,h=Math.floor,d=function(t,e,i){return 0===e?i:e%2===1?d(t,e-1,i*t):d(t*t,e/2,i)},c=function(t){var e=0,i=t;while(i>=4096)e+=12,i/=4096;while(i>=2)e+=1,i/=2;return e},p=l&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n((function(){l.call({})}));r({target:"Number",proto:!0,forced:p},{toFixed:function(t){var e,i,r,n,l=o(this),p=s(t),f=[0,0,0,0,0,0],g="",m="0",u=function(t,e){var i=-1,r=e;while(++i<6)r+=t*f[i],f[i]=r%1e7,r=h(r/1e7)},w=function(t){var e=6,i=0;while(--e>=0)i+=f[e],f[e]=h(i/t),i=i%t*1e7},b=function(){var t=6,e="";while(--t>=0)if(""!==e||0===t||0!==f[t]){var i=String(f[t]);e=""===e?i:e+a.call("0",7-i.length)+i}return e};if(p<0||p>20)throw RangeError("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(g="-",l=-l),l>1e-21)if(e=c(l*d(2,69,1))-69,i=e<0?l*d(2,-e,1):l/d(2,e,1),i*=4503599627370496,e=52-e,e>0){u(0,i),r=p;while(r>=7)u(1e7,0),r-=7;u(d(10,r,1),0),r=e-1;while(r>=23)w(1<<23),r-=23;w(1<<r),u(1,1),w(2),m=b()}else u(0,i),u(1<<-e,0),m=b()+a.call("0",p);return p>0?(n=m.length,m=g+(n<=p?"0."+a.call("0",p-n)+m:m.slice(0,n-p)+"."+m.slice(n-p))):m=g+m,m}})}}]);